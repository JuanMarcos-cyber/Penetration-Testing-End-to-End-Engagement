# 06 – Post-Exploitation Phase
=============================

## Objective

The objective of this phase was to document the post-exploitation activities
performed after successful initial exploitation (Phases 04 and 05). This phase
focuses on persistence, credential compromise, attack chaining, and forensic
evidence demonstrating sustained attacker access.

Unlike previous phases, Phase 06 evaluates the **real-world impact of continued
attacker presence**, rather than individual vulnerability exploitation.

---

## Scope Clarification

The following vulnerabilities were already exploited and documented in
previous phases and are **not re-detailed here**:

- SQL Injection
- Command Injection
- Local File Inclusion (LFI)
- Cross-Site Scripting (XSS)

Phase 06 focuses exclusively on **new post-exploitation outcomes enabled by
those vulnerabilities**, including persistence, credential cracking, and full
attack lifecycle reconstruction.

---

## Persistent Access via Unrestricted File Upload (Web Shell)

### Description

An unrestricted file upload vulnerability in the DVWA File Upload module
allowed the upload of a malicious PHP file containing server-side executable
code. The application failed to validate file type, extension, and content.


---

### Observed Results

The following PHP web shell was successfully uploaded:

```php
<?php system($_GET["cmd"]); ?>
```

Confirmed storage location:

```bash
/var/www/html/hackable/uploads/webshell.php
```

The presence of this file confirms persistent remote command execution
capability, independent of the initial exploitation vector.

---

## Impact

- Persistent attacker access  
- Arbitrary command execution on demand  
- Bypass of application authentication  
- Platform for deploying additional malicious tooling  

This marks the transition from initial exploitation to full system
compromise.

---

## Credential Harvesting from Database

### SQL Injection–Derived Credentials

User credentials were extracted from the backend database during prior SQL
Injection exploitation using a UNION-based payload.

```sql
' UNION SELECT user, password FROM users #
```

**Source:** SQLi results

### Extracted Users and Password Hashes (MD5)

| Username | Password Hash (MD5) |
|--------|----------------------|
| admin   | 5f4dcc3b5aa765d61d8327deb882cf99 |
| gordonb| e99a18c428cb38d5f260853678922e03 |
| 1337   | 8d3533d75ae2c396d7e04f4cc69216b |
| pablo  | 0d107d09f5bbe40cade3de5c71e9e9b7 |
| smithy | 5f4dcc3b5aa765d61d8327deb882cf99 |

**Sources:**  
- SQLi results  
- harvestedUsers  

> **Note:** A minor hash formatting discrepancy for user `1337` was observed
> between evidence files.
>
> The hash value associated with this user differs slightly between
> `SQLi results.txt` and `harvestedUsers.txt`. This discrepancy is limited to
> character ordering/formatting and does not affect the overall assessment.
>
> For audit accuracy, the SQL Injection output is treated as the **primary
> source**, as it represents the direct database response obtained during live
> exploitation, while `harvestedUsers.txt` is considered a secondary artifact
> generated during post-processing.

---

## Password Hash Analysis and Cracking

### Hash Type Identification

The extracted password hashes were identified as **MD5**, a weak and deprecated
hashing algorithm lacking salting.


---

### Cracking Methodology

Due to the unavailability of John the Ripper in the lab environment, an online
hash lookup service (e.g., CrackStation / MD5Decrypt) was used, as permitted by
lab guidelines.


---

### Proven Cracking Result

The following MD5 hash was successfully cracked:

```text
Hash: 5d41402abc4b2a76b9719d911017c592
Plaintext Password: hello
```

![MD5 hash cracking result](screenshots/Screenshot%20MD5%20crack.png)


**Audit note:** This cracking result demonstrates the feasibility of MD5
password recovery. The evidence does not explicitly link this hash to a
specific DVWA user account and is therefore treated as a proof-of-concept
rather than a direct credential match.

---

## Impact

- Confirms insecurity of MD5 password storage  
- Enables authenticated access without exploitation  
- Supports privilege abuse and attack chaining  
- Demonstrates realistic offline password attack feasibility  

---

## Full Attack Chain Analysis

Rather than isolated vulnerabilities, the assessment demonstrates how multiple
weaknesses can be chained together to achieve full compromise.

### Observed Attack Progression

- SQL Injection → Credential harvesting  
- Weak password hashing → Password recovery  
- Authenticated access → Abuse of privileged features  
- Unrestricted file upload → Persistent web shell deployment  
- Command execution → System enumeration  
- LFI and XSS → Additional data access and session compromise  


This chain illustrates how low-complexity vulnerabilities escalate into
critical impact when combined.

---

## Forensic Timeline of Post-Exploitation Activity (UTC)

The following timeline reconstructs attacker activity using Docker events,
Apache logs, filesystem artifacts, and database access records.


### Timeline

**2025-12-23 21:42:47**  
- Previous DVWA container destroyed  
  - Evidence: `container destroy (old DVWA container)`

**2025-12-23 21:42:48 – 21:42:49**  
- DVWA container redeployed and started  
  - Evidence: image pull, container create, container start

**2025-12-23 21:45:56**  
- Initial web access to file upload module  
  - `GET /vulnerabilities/upload/ HTTP/1.1" 302`

**2025-12-23 21:45:58**  
- Authentication and setup access  
  - `POST /login.php`  
  - `GET /setup.php`

**2025-12-23 21:46:01**  
- Application warning during setup  
  - PHP Notice: `DVWA_WEB_PAGE_TO_ROOT already defined`

**2025-12-23 21:46:24**  
- Local File Inclusion attempt recorded  
  - `GET /vulnerabilities/fi/?page=../../../../etc/passwd`

**2025-12-23 21:47:29 – 21:52:00**  
- Malicious file upload and persistence established  
  - `POST /vulnerabilities/upload/ HTTP/1.1" 200`  
  - File artifact: `webshell.php` in uploads directory

**2025-12-23 22:03:03**  
- Interactive container access initiated  
  - `container exec_create /bin/bash`

**2025-12-23 22:03:03 – 22:08:07**  
- Post-exploitation activity  
  - Network exposure: `0.0.0.0:8080 LISTEN docker-proxy`  
  - Database access: `mysql -u root -p dvwa` (authentication successful)

**2025-12-23 22:08:07**  
- Interactive session terminated  
  - `container exec_die (exitCode=1)`

---

## Overall Post-Exploitation Impact

The post-exploitation activities demonstrate:

- Persistent attacker access  
- Credential compromise  
- Database-level access  
- Ability to execute commands and maintain long-term presence  
- Severe confidentiality, integrity, and availability impact  


---

## Conclusion

Phase 06 demonstrates how initial exploitation escalates into full compromise
through post-exploitation techniques such as persistence, password cracking,
attack chaining, and sustained access.

The evidence confirms that vulnerabilities must be addressed holistically.
Without defense-in-depth controls, attackers can reliably achieve long-term
access and complete system compromise.
