# 03 – Threat Modeling

## Objective

The objective of this phase was to identify, categorize, and prioritize threats
affecting the target environment by analyzing assets, trust boundaries, attack
surface, and potential attacker paths identified during reconnaissance.

This phase was completed **before exploitation** in order to guide testing
priorities and assess risk realistically.

---

## Environment Context

The target is the Damn Vulnerable Web Application (DVWA), deployed in a
Docker-based laboratory environment and accessed locally via HTTP.

- Application: DVWA v1.10 (Development)
- Web Server: Apache (Debian)
- Backend: PHP
- Database: MariaDB (internal Docker container)
- Access Method: Browser-based HTTP requests

The application is intentionally vulnerable and used for security training.

---

## Asset Inventory

The following assets were identified and classified based on value and impact:

### Critical Assets

- **User Credentials Database**  
  Impact: Authentication bypass, account takeover, credential disclosure

- **Application Database (MariaDB)**  
  Impact: Data manipulation, stored payload injection, integrity loss

- **DVWA Web Application Availability**  
  Impact: Loss of access to training environment

- **Server Infrastructure (Docker Containers)**  
  Impact: Command execution, full application compromise

- **Session Data (PHPSESSID, security cookie)**  
  Impact: Session hijacking, impersonation

### Data Classification

- **Public**: Static pages, instructions, public HTML/CSS
- **Internal**: Application source code, PHP logic, configuration files
- **Confidential**: User credentials, session cookies
- **Restricted**: Database credentials, internal container configuration

---

## Attack Surface Analysis

### External Attack Surface

- HTTP service exposed on port 4280
- Login functionality (`login.php`)
- Vulnerability modules under `/vulnerabilities/`
- File upload functionality
- Security configuration (`security.php`)
- Database reset functionality (`setup.php`)

### Internal Attack Surface

- SQL queries generated by PHP backend
- File system access within the container
- PHP include mechanisms
- Uploaded file storage paths

### Network Attack Surface

- Inter-container communication between DVWA and MariaDB
- Internal MySQL traffic (port 3306, Docker-only)

The attack surface is broad and directly maps to common OWASP vulnerability classes.

---

## Trust Boundaries

The following trust boundaries were identified:

### External Boundary
- Actor: End users (including attackers)
- Interface: HTTP requests
- Trust Level: Untrusted

### Web Application Boundary
- Components: Apache + DVWA PHP
- Trust Level: Semi-trusted
- Risk: Direct processing of user input

### Authentication Boundary
- Separation between authenticated and unauthenticated users
- Session managed via PHPSESSID cookie
- Risk: Session fixation and hijacking

### Database Boundary
- Component: MariaDB container
- Trust Level: Trusted (relies entirely on application sanitization)

### Trust Flow Overview

[External User] --> [DVWA Web Application] --> [Application Logic] --> [MariaDB]
Untrusted Semi-trusted Semi-trusted Trusted

yaml
Copy code

---

## Source Code Observations

Review of application source code revealed:

- Direct use of user-supplied input in SQL queries
- Lack of input sanitization and output encoding
- Security level explicitly set via client-side cookie
- Vulnerability modules clearly exposed via navigation menu
- Error handling reveals system behavior and structure

These observations confirm the feasibility of multiple attack vectors.

---

## Attack Vector Analysis

### SQL Injection
- Entry Point: Login form, SQLi modules
- Preconditions: No input validation
- Impact: Authentication bypass, data extraction
- STRIDE: Spoofing, Tampering

### Cross-Site Scripting (XSS)
- Entry Point: Stored and reflected input fields
- Preconditions: No output encoding
- Impact: Session hijacking, client-side attacks
- STRIDE: Tampering, Information Disclosure

### Local File Inclusion (LFI)
- Entry Point: File include parameters
- Preconditions: Path traversal allowed
- Impact: File disclosure, source code exposure
- STRIDE: Information Disclosure, Elevation of Privilege

### Command Injection
- Entry Point: OS command execution module
- Preconditions: Unsanitized command input
- Impact: Arbitrary command execution
- STRIDE: Tampering, Elevation of Privilege

---

## STRIDE Analysis by Component

| Component | Primary Threats |
|--------|----------------|
| Login System | Spoofing, Tampering |
| User Input Forms | Tampering, Information Disclosure |
| Session Handling | Spoofing |
| Database Layer | Tampering, Information Disclosure |
| File Upload | Tampering, Elevation of Privilege |
| Application Logic | Elevation of Privilege |

### High-Risk Threats (Likelihood + Impact)

1. SQL Injection (authentication and data access)
2. Command Injection
3. File Upload leading to RCE
4. Weak session management
5. Stored XSS with session theft

---

## Threat Modeling Summary

This threat modeling phase established:

- High-value assets requiring protection
- Clear trust boundaries and privilege transitions
- Realistic attacker paths
- Prioritized threat categories based on risk

The results of this phase directly informed the
Vulnerability Assessment and Exploitation phases.

---

## Transition to Next Phase

➡️ **04 – Vulnerability Assessment**

The next phase focuses on:
- Validating identified threats
- Confirming exploitable vulnerabilities
- Assessing technical severity and impact
